name: Lua Script CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  lint-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Lua environment
      run: |
        sudo apt-get update
        sudo apt-get install -y luarocks
        luarocks --local install luacheck

    - name: Add LuaRocks local bin to PATH
      run: |
        echo "Adding LuaRocks local bin to PATH"
        echo "::add-path::$(luarocks path --bin)"
        echo "::add-path::$(luarocks path --tree)/bin"

    - name: Verify LuaRocks and Luacheck installation
      run: |
        luarocks list
        luacheck --version

    - name: Run Lua Linter
      run: luacheck . --exclude-files .github/ --codes

    - name: Basic Script Check
      run: lua scripts/norecoil.lua
      working-directory: scripts/

    - name: Display Workflow Completion
      run: echo "CI tasks completed successfully!"
